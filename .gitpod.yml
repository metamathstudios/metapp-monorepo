# This configuration file was automatically generated by Gitpod.
# Please adjust to your needs (see https://www.gitpod.io/docs/config-gitpod-file)
# and commit this file to your remote git repository to share the goodness with others.

github:
  prebuilds:
    # Only prebuild in master branch
    master: true
    branches: false
    pullRequests: false
    pullRequestsFromForks: false
    addCheck: false
    addComment: false
    addBadge: false
tasks:

  - name: Installing Dependencies
    before: cd backend
    init: |
      echo 'ðŸ“¦ Installing Dependencies'
      npm install && npm run build
      cp .env.template .env
  - name: Docker Setup
    before: cd backend
    command: |
      echo 'ðŸš€ Starting Docker - PostgreSQL - Adminer'
      docker-compose pull
      gp sync-done "docker-up"
      docker-compose up

  - name: Start API Server
    before: cd backend
    init: |
      gp sync-await "docker-up" && sleep 45s
      npx prisma migrate dev
      
    command: |
      gp sync-await "docker-up" && sleep 5s
      gp sync-done "server-api-up"
      npm run start:dev

  - name: Web Dapp Server
    before: cd frontend_app
    command: |
      gp sync-await "server-api-up"
      cp .env.template .env
      gp url 3001 >> .env
      yarn && yarn run dev      

ports:
  - port: 8080
    visibility: public
    onOpen: ignore
  - port: 3000
    visibility: public
    onOpen: open-browser
  - port: 3001
    visibility: public
    onOpen: ignore
  - port: 5432
    onOpen: ignore
    
vscode:
  extensions:
    - ms-azuretools.vscode-docker

